<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>Washportal â€“ Clean RBAC</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body{font-family:system-ui;margin:0;background:#f5f6f8}
header{background:#1f2937;color:#fff;padding:12px 16px}
.card{background:#fff;margin:14px;padding:16px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
.hidden{display:none!important}
button{padding:8px 14px;border:0;border-radius:8px;background:#2563eb;color:#fff;cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
.tile{padding:20px;border-radius:10px;background:#e5e7eb}
</style>
</head>

<body>

<header>Washportal</header>

<div id="loginCard" class="card">
  <h3>Login</h3>
  <input id="email" placeholder="Email"><br><br>
  <input id="pw" type="password" placeholder="Passwort"><br><br>
  <button id="loginBtn">Login</button>
</div>

<div id="dash" class="hidden">
  <div class="grid">
    <div id="tBookings" class="tile hidden">Buchungen</div>
    <div id="tConfig" class="tile hidden">Konfiguration</div>
    <div id="tRooms" class="tile hidden">Zimmer sperren</div>
    <div id="tFeedback" class="tile hidden">Feedback</div>
    <div id="tLogs" class="tile hidden">Logs</div>
    <div id="tProtocol" class="tile hidden">Protokoll</div>
    <div id="tUsers" class="tile hidden">Benutzer</div>
  </div>
</div>

<script>
function show(id, ok){
  document.getElementById(id).classList.toggle("hidden", !ok);
}

async function post(url, body){
  const r = await fetch(url,{
    method:"POST",
    credentials:"include",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(body||{})
  });
  return r.json();
}

async function authMe(){
  return post("/api/auth/me",{});
}

async function login(){
  await post("/api/auth/login",{email:email.value,password:pw.value});
  await render();
}

async function render(){
  const me = await authMe();
  if(!me || !me.ok || !me.user) return;

  loginCard.classList.add("hidden");
  dash.classList.remove("hidden");

  const p = me.perms || {};

  show("tBookings", p["bookings.view"] || p["admin.bookings.view"]);
  show("tConfig", p["admin.config.view"] || p["admin.config.manage"] || p["ps.config.view"]);
  show("tRooms", p["rooms.manage"] || p["ps.rooms.manage"] || p["admin.roomcontrol.manage"]);
  show("tFeedback", p["feedback.view"] || p["ps.feedback.view"] || p["admin.feedback.view"]);
  show("tLogs", p["admin.logs.view"] || p["ps.logs.view"]);
  show("tProtocol", p["protocol.view"]);
  show("tUsers", p["admin.users.manage"] || p["admin.users.view"]);
}

loginBtn.addEventListener("click", login);

window.addEventListener("load", render);
</script>

</body>
</html>
