<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Registrierung – Washportal</title>
<style>
  :root{--bg0:#07131f;--bg1:#0b1b2b;--card:rgba(255,255,255,.06);--stroke:rgba(255,255,255,.10);--txt:#e8f1ff;--muted:rgba(232,241,255,.70);--r:18px;}
  *{box-sizing:border-box}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica,Arial;color:var(--txt);
    background: radial-gradient(1200px 700px at 20% 15%, rgba(42,118,255,.25), transparent 60%),
                radial-gradient(900px 600px at 70% 55%, rgba(40,198,178,.22), transparent 60%),
                linear-gradient(180deg,var(--bg0),var(--bg1));
    min-height:100vh;}
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  .card{background:var(--card);border:1px solid var(--stroke);border-radius:var(--r);padding:16px;margin-bottom:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.28);backdrop-filter: blur(10px);}
  h1{margin:0 0 6px 0;font-size:22px}
  .muted{color:var(--muted)}
  .row{display:flex;flex-wrap:wrap;gap:12px;align-items:flex-end}
  .field{display:flex;flex-direction:column;gap:6px;min-width:220px;flex:1}
  label{font-size:12px;color:var(--muted)}
  input,select{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.22);color:var(--txt);outline:none}
  button{padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.10);color:var(--txt);cursor:pointer}
  button:hover{background:rgba(255,255,255,.14)}
  .badge{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.14);font-size:12px}
  .ok{background:rgba(40,198,178,.14)}
  .bad{background:rgba(255,86,86,.14)}
  .small{font-size:12px}
  code{background:rgba(0,0,0,.25);padding:2px 6px;border-radius:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Registrierung</h1>
    <div class="muted">Account erstellen (Wunschrolle wird gespeichert). Freischaltung erfolgt durch Admin/SA bzw. PS/SV-Übergabe.</div>
    <div class="small muted" style="margin-top:8px">Worker: <code id="w"></code></div>
  </div>

  <div class="card">
    <div class="row">
      <div class="field" style="min-width:320px;flex:2">
        <label>Worker Base URL</label>
        <input id="base" value="https://washportal-dev-worker.schluffi1220.workers.dev"/>
      </div>
    </div>
    <div class="row" style="margin-top:12px">
      <div class="field">
        <label>Email</label>
        <input id="email" placeholder="name@domain.de"/>
      </div>
      <div class="field">
        <label>Vorname</label>
        <input id="firstName" placeholder="Max"/>
      </div>
      <div class="field">
        <label>Nachname</label>
        <input id="lastName" placeholder="Mustermann"/>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <div class="field">
        <label>Passwort</label>
        <input id="password" type="password" placeholder="mind. 6 Zeichen"/>
      </div>
      <div class="field">
        <label>Wunschrolle</label>
        <select id="role">
          <option value="user">User</option>
          <option value="ps">PS</option>
          <option value="sv">SV</option>
        </select>
        <div class="small muted">Admin/SA müssen freischalten. Für PS/SV läuft die Übergabe über Admin/SA oder den aktuellen PS/SV.</div>
      </div>
      <div class="field" style="flex:0;min-width:220px">
        <label>&nbsp;</label>
        <button id="btnRegister">Registrieren</button>
      </div>
    </div>

    <div style="margin-top:12px" id="status"></div>
  </div>
</div>

<script>
const el = (id)=>document.getElementById(id);
function setStatus(text, ok){
  const s = el("status");
  s.innerHTML = text ? `<span class="badge ${ok ? "ok":"bad"}">${text}</span>` : "";
}
function base(){ return (el("base").value||"").replace(/\/+$/,""); }

el("w").textContent = base();
el("base").addEventListener("input", ()=>{ el("w").textContent = base(); });

el("btnRegister").addEventListener("click", async ()=>{
  try {
    setStatus("… sendet", true);
    const payload = {
      email: el("email").value.trim(),
      firstName: el("firstName").value.trim(),
      lastName: el("lastName").value.trim(),
      password: el("password").value,
      role: el("role").value
    };
    const r = await fetch(base()+"/api/auth/register", {
      method:"POST",
      headers:{"content-type":"application/json"},
      body: JSON.stringify(payload)
    });
    const data = await r.json().catch(()=>({}));
    if (!r.ok || !data.ok) throw new Error(data.message || data.error || "Registrierung fehlgeschlagen");
    setStatus("Registriert. Wartet auf Freischaltung.", true);
    el("password").value = "";
  } catch(e) {
    setStatus(String(e.message||e), false);
  }
});
</script>
</body>
</html>

