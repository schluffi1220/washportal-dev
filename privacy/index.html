<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Privacy – Washportal</title>
<style>
  :root{
    color-scheme:dark;
    --bg:#070b12;
    --card:rgba(255,255,255,.035);
    --line:rgba(255,255,255,.10);
    --txt:#e7eefc;
    --muted:rgba(231,238,252,.68);
    --accent:#5aa7ff;
    --shadow:0 12px 40px rgba(0,0,0,.35);
    --r:16px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;background:radial-gradient(1200px 700px at 10% -10%, rgba(90,167,255,.18), transparent 60%),var(--bg);color:var(--txt)}
  .wrap{max-width:900px;margin:0 auto;padding:14px}
  header{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:12px}
  .brand{display:flex;gap:10px;align-items:center}
  .logo{width:34px;height:34px;border-radius:12px;background:linear-gradient(135deg, rgba(90,167,255,.95), rgba(66,211,146,.8));box-shadow:var(--shadow)}
  h1{font-size:14px;margin:0;font-weight:900;letter-spacing:.4px}
  .sub{font-size:11px;color:var(--muted);margin-top:1px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);box-shadow:var(--shadow)}
  .card .bd{padding:12px}
  label{display:block;font-size:11px;color:var(--muted);margin:0 0 6px 2px}
  input,button{width:100%;border-radius:14px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.05);color:var(--txt);padding:10px 11px;font-size:13px}
  button{cursor:pointer;background:linear-gradient(180deg, rgba(90,167,255,.25), rgba(90,167,255,.10));border-color:rgba(90,167,255,.35)}
  .mono{margin-top:10px;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:11px;white-space:pre-wrap;word-break:break-word;background:rgba(0,0,0,.22);border-radius:14px;padding:10px;border:1px solid rgba(255,255,255,.10)}
  .muted{color:var(--muted)}
  ul{margin:8px 0 0 18px;color:var(--muted);font-size:12px;line-height:1.5}
  hr{border:none;border-top:1px solid var(--line);margin:12px 0}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Datenschutz – Washportal</h1>
        <div class="sub">Live-Infos kommen aus <code>/api/privacy/meta</code></div>
      </div>
    </div>
  </header>

  <div class="card">
    <div class="bd">
      <label>API Base (Worker URL)</label>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <input id="baseUrl" placeholder="https://<dein-worker>.workers.dev" style="flex:1;min-width:260px"/>
        <button id="btnLoad" style="width:180px">Laden</button>
      </div>

      <hr>

      <div id="human"></div>
      <div id="raw" class="mono">—</div>

      <hr>

      <div class="muted" style="font-size:12px;line-height:1.55">
        Dieses Portal arbeitet primär mit <b>Zimmer + PIN</b> (kein klassischer Nutzer-Account im Portal).
        Für Admin-Funktionen existieren optional Accounts + RBAC im Worker.
      </div>
    </div>
  </div>
</div>

<script>
const $ = (id)=>document.getElementById(id);
function base(){ return String($('baseUrl').value||'').trim().replace(/\/+$/,''); }
function escapeHtml(s){ return String(s??'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

async function load(){
  const url = base() + '/api/privacy/meta';
  const res = await fetch(url, {method:'GET'});
  const txt = await res.text();
  let j; try{ j=JSON.parse(txt); }catch{ j={raw:txt}; }
  $('raw').textContent = JSON.stringify(j, null, 2);

  if(!res.ok){
    $('human').innerHTML = `<div class="muted">Fehler beim Laden: ${escapeHtml(j.message||j.error||('HTTP '+res.status))}</div>`;
    return;
  }
  const m = j.meta || {};
  const items = [];
  if(m.note) items.push(`<li>${escapeHtml(m.note)}</li>`);
  if(m.retention) items.push(`<li><b>Retention:</b> ${escapeHtml(m.retention)}</li>`);
  if(m.dataTypes && Array.isArray(m.dataTypes)) items.push(`<li><b>Daten:</b> ${escapeHtml(m.dataTypes.join(', '))}</li>`);
  if(m.security) items.push(`<li><b>Sicherheit:</b> ${escapeHtml(m.security)}</li>`);
  $('human').innerHTML = `
    <div style="font-size:13px;line-height:1.55">
      <b>Kurzübersicht</b>
      <ul>${items.join('') || '<li>—</li>'}</ul>
    </div>`;
}

$('btnLoad').addEventListener('click', load);
(function boot(){
  const prev = localStorage.getItem('wp_privacy_base') || '';
  if(prev) $('baseUrl').value = prev;
  $('baseUrl').addEventListener('change', ()=>localStorage.setItem('wp_privacy_base', $('baseUrl').value.trim()));
})();
</script>
</body>
</html>
